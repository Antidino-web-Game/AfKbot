<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AfKBot Panel</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');

    :root {
      --bg:      #050a0e;
      --panel:   #0a1520;
      --border:  #0e2a40;
      --accent:  #00ff88;
      --accent2: #00c8ff;
      --accent3: #ff4466;
      --text:    #b0d8e8;
      --muted:   #3a6078;
      --glow:    0 0 12px #00ff8855;
      --glow2:   0 0 12px #00c8ff55;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Share Tech Mono', monospace;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Scanlines */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px);
      pointer-events: none;
      z-index: 9999;
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      background: linear-gradient(90deg, #050a0e, #0a1a28, #050a0e);
      border-bottom: 1px solid var(--border);
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      height: 48px;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      font-weight: 900;
      color: var(--accent);
      text-shadow: 0 0 20px var(--accent);
      letter-spacing: 4px;
    }
    .logo span { color: var(--accent2); }

    .header-right { display: flex; align-items: center; gap: 12px; }

    .status-pill {
      display: flex; align-items: center; gap: 6px;
      padding: 3px 12px; border-radius: 20px;
      border: 1px solid var(--muted);
      font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase;
      transition: all .3s;
    }
    .status-pill.online     { border-color: var(--accent);  color: var(--accent);  box-shadow: var(--glow); }
    .status-pill.offline    { border-color: var(--accent3); color: var(--accent3); }
    .status-pill.connecting { border-color: #ffaa00; color: #ffaa00; animation: blink 1s infinite; }
    .dot { width: 7px; height: 7px; border-radius: 50%; background: currentColor; }
    .online .dot { animation: pulse 2s infinite; box-shadow: 0 0 6px var(--accent); }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.2} }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }

    /* â”€â”€ Layout principal â”€â”€ */
    .main {
      display: grid;
      grid-template-columns: 260px 1fr 280px;
      flex: 1;
      overflow: hidden;
    }

    /* â”€â”€ Colonne gÃ©nÃ©rique â”€â”€ */
    .col {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-right: 1px solid var(--border);
    }
    .col:last-child { border-right: none; border-left: 1px solid var(--border); }

    .col-hd {
      padding: 8px 12px;
      background: rgba(0,200,255,.04);
      border-bottom: 1px solid var(--border);
      font-family: 'Orbitron', sans-serif;
      font-size: 0.6rem; letter-spacing: 3px; text-transform: uppercase;
      color: var(--accent2);
      display: flex; align-items: center; gap: 6px;
      flex-shrink: 0;
    }
    .col-hd::before {
      content: ''; width: 3px; height: 11px;
      background: var(--accent2); border-radius: 2px;
      box-shadow: 0 0 6px var(--accent2);
    }

    /* â”€â”€ Formulaire & boutons â”€â”€ */
    .section { padding: 12px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .lbl { font-size: 0.58rem; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; margin-bottom: 6px; }

    input, select {
      width: 100%;
      background: rgba(0,200,255,.04);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 6px 9px;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.78rem;
      border-radius: 3px;
      margin-bottom: 5px;
      outline: none;
      transition: border .2s;
    }
    input:focus, select:focus { border-color: var(--accent2); box-shadow: var(--glow2); }
    select option { background: #0a1520; }

    .btn {
      width: 100%; padding: 8px; border: none; border-radius: 3px;
      font-family: 'Orbitron', sans-serif; font-size: 0.65rem;
      letter-spacing: 2px; cursor: pointer; text-transform: uppercase;
      transition: all .2s; margin-bottom: 5px;
    }
    .btn-start { background: rgba(0,255,136,.1); border: 1px solid var(--accent);  color: var(--accent); }
    .btn-start:hover { background: rgba(0,255,136,.2); box-shadow: var(--glow); }
    .btn-stop  { background: rgba(255,68,102,.1);  border: 1px solid var(--accent3); color: var(--accent3); }
    .btn-stop:hover  { background: rgba(255,68,102,.2); box-shadow: 0 0 10px #ff446655; }
    .btn-ak    { background: rgba(0,200,255,.08);  border: 1px solid var(--accent2); color: var(--accent2); }
    .btn-ak:hover    { background: rgba(0,200,255,.15); }
    .btn-ak.active   { background: rgba(0,200,255,.2); box-shadow: var(--glow2); }

    /* â”€â”€ Stats â”€â”€ */
    .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; padding: 10px; flex-shrink: 0; }
    .stat { background: rgba(0,200,255,.04); border: 1px solid var(--border); border-radius: 3px; padding: 6px 9px; }
    .stat-n { font-size: 0.52rem; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; }
    .stat-v { font-size: 0.85rem; color: var(--accent2); text-shadow: 0 0 6px var(--accent2); margin-top: 1px; }

    /* Barres vie/faim */
    .bars { padding: 0 10px 8px; flex-shrink: 0; }
    .bar-lbl { font-size: 0.55rem; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 3px; }
    .bar-row { display: flex; align-items: center; gap: 7px; margin-bottom: 5px; }
    .bar-tr { flex:1; height:5px; background: var(--border); border-radius: 3px; overflow: hidden; }
    .bar-fi { height:100%; border-radius: 3px; transition: width .5s; }
    .bar-fi.hp { background: linear-gradient(90deg,#ff4466,#ff8866); box-shadow: 0 0 5px #ff446677; }
    .bar-fi.fd { background: linear-gradient(90deg,#ffaa00,#ffdd00); box-shadow: 0 0 5px #ffaa0077; }
    .bar-vl { font-size: 0.68rem; color: var(--text); min-width: 24px; text-align: right; }

    /* â”€â”€ EntitÃ©s â”€â”€ */
    .entity-scroll { flex:1; overflow-y: auto; padding: 5px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
    .ent { display: flex; justify-content: space-between; padding: 4px 7px; border-radius: 3px; font-size: 0.68rem; border-left: 2px solid transparent; margin-bottom: 2px; }
    .ent.player { border-color: var(--accent2); background: rgba(0,200,255,.04); }
    .ent.mob    { border-color: var(--accent3); background: rgba(255,68,102,.04); }
    .ent.other  { border-color: var(--muted); }
    .ent-dist   { color: var(--muted); }

    /* â”€â”€ Vue prismarine-viewer (centre) â”€â”€ */
    .view-col { background: #000; position: relative; }
    #prismarineFrame {
      width: 100%; height: 100%;
      border: none;
      display: block;
    }
    .view-overlay {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: var(--bg);
      gap: 14px;
      transition: opacity .4s;
    }
    .view-overlay.hidden { opacity: 0; pointer-events: none; }
    .view-overlay-icon { font-size: 3rem; }
    .view-overlay-text { font-family: 'Orbitron', sans-serif; color: var(--muted); font-size: 0.75rem; letter-spacing: 3px; }

    .hud-bar {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: rgba(5,10,14,.85);
      border-top: 1px solid var(--border);
      padding: 5px 14px;
      display: flex; gap: 20px; align-items: center;
      font-size: 0.7rem; color: var(--text);
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    .hud-item { display: flex; gap: 5px; }
    .hud-lbl { color: var(--muted); }
    .hud-val { color: var(--accent2); }

    /* â”€â”€ Chat â”€â”€ */
    .chat-log {
      flex: 1; overflow-y: auto; padding: 8px;
      display: flex; flex-direction: column; gap: 2px;
      scrollbar-width: thin; scrollbar-color: var(--border) transparent;
    }
    .msg { font-size: 0.72rem; line-height: 1.4; padding: 3px 7px; border-radius: 3px; border-left: 2px solid transparent; word-break: break-word; }
    .msg.chat   { border-color: var(--accent2); }
    .msg.sent   { border-color: var(--accent);  color: var(--accent); }
    .msg.system { border-color: var(--muted);   color: var(--muted); font-size: 0.65rem; }
    .msg.server { border-color: #ffaa00;        color: #ffaa00; }
    .msg.error  { border-color: var(--accent3); color: var(--accent3); background: #ff446610; }
    .msg-t { color: var(--muted); margin-right: 5px; font-size: 0.62rem; }

    .chat-row { padding: 8px; border-top: 1px solid var(--border); display: flex; gap: 6px; flex-shrink: 0; }
    .chat-inp { flex: 1; margin: 0 !important; }
    .btn-send {
      padding: 6px 11px; background: rgba(0,255,136,.1);
      border: 1px solid var(--accent); color: var(--accent);
      border-radius: 3px; cursor: pointer; font-size: 1rem; transition: all .2s;
    }
    .btn-send:hover { background: rgba(0,255,136,.2); box-shadow: var(--glow); }

    ::-webkit-scrollbar { width: 3px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  </style>
</head>
<body>

<header>
  <div class="logo">AFk<span>BOT</span>&nbsp;<span style="font-size:.65rem;color:var(--muted);letter-spacing:2px">PANEL</span></div>
  <div class="header-right">
    <div id="hudServer" style="font-size:.7rem;color:var(--muted)">Non connectÃ©</div>
    <div class="status-pill offline" id="statusPill">
      <div class="dot"></div><span id="statusTxt">HORS LIGNE</span>
    </div>
  </div>
</header>

<div class="main">

  <!-- â•â• GAUCHE â€” ContrÃ´les â•â• -->
  <div class="col">
    <div class="col-hd">Serveur</div>

    <div class="section">
      <div class="lbl">Connexion</div>
      <input id="cfgHost"    type="text"   placeholder="IP du serveur"   value="playnoctissmp.falix.pro"/>
      <input id="cfgPort"    type="number" placeholder="Port"             value="28665"/>
      <input id="cfgUser"    type="text"   placeholder="Pseudo"           value="lebg95"/>
      <input id="cfgPass"    type="password" placeholder="Mot de passe AutoAuth" value="aqwzsx"/>
      <select id="cfgVer">
        <option value="1.21.4" selected>1.21.4</option>
        <option value="1.20.4">1.20.4</option>
        <option value="1.20.1">1.20.1</option>
        <option value="1.19.4">1.19.4</option>
        <option value="1.18.2">1.18.2</option>
        <option value="1.16.5">1.16.5</option>
        <option value="1.12.2">1.12.2</option>
        <option value="1.8.9">1.8.9</option>
      </select>
      <button class="btn btn-start" onclick="startBot()">â–¶ DÃ©marrer</button>
      <button class="btn btn-stop"  onclick="stopBot()">â–  ArrÃªter</button>
    </div>

    <div class="section">
      <div class="lbl">Anti-Kick</div>
      <button class="btn btn-ak" id="btnAK" onclick="toggleAK()">âš™ Anti-Kick : OFF</button>
    </div>

    <div class="stat-grid">
      <div class="stat"><div class="stat-n">X</div><div class="stat-v" id="posX">â€”</div></div>
      <div class="stat"><div class="stat-n">Z</div><div class="stat-v" id="posZ">â€”</div></div>
      <div class="stat"><div class="stat-n">Y</div><div class="stat-v" id="posY">â€”</div></div>
      <div class="stat"><div class="stat-n">Dim</div><div class="stat-v" id="posDim" style="font-size:.65rem">â€”</div></div>
    </div>

    <div class="bars">
      <div class="bar-lbl">Vie</div>
      <div class="bar-row"><div class="bar-tr"><div class="bar-fi hp" id="barHp" style="width:100%"></div></div><div class="bar-vl" id="valHp">20</div></div>
      <div class="bar-lbl">Nourriture</div>
      <div class="bar-row"><div class="bar-tr"><div class="bar-fi fd" id="barFd" style="width:100%"></div></div><div class="bar-vl" id="valFd">20</div></div>
    </div>

    <div class="col-hd">EntitÃ©s proches</div>
    <div class="entity-scroll" id="entList">
      <div style="color:var(--muted);font-size:.68rem;padding:8px">Aucune entitÃ©</div>
    </div>
  </div>

  <!-- â•â• CENTRE â€” Prismarine-Viewer iframe â•â• -->
  <div class="col view-col">

    <!-- Overlay quand bot offline -->
    <div class="view-overlay" id="viewOverlay">
      <div class="view-overlay-icon">ðŸŽ®</div>
      <div class="view-overlay-text">DÃ©marre le bot pour voir la vue 3D</div>
    </div>

    <iframe id="prismarineFrame" src="about:blank" allowfullscreen></iframe>

    <!-- HUD bas -->
    <div class="hud-bar">
      <div class="hud-item"><span class="hud-lbl">X</span><span class="hud-val" id="hudX">â€”</span></div>
      <div class="hud-item"><span class="hud-lbl">Y</span><span class="hud-val" id="hudY">â€”</span></div>
      <div class="hud-item"><span class="hud-lbl">Z</span><span class="hud-val" id="hudZ">â€”</span></div>
      <div class="hud-item"><span class="hud-lbl">Yaw</span><span class="hud-val" id="hudYaw">â€”</span></div>
      <div class="hud-item"><span class="hud-lbl">Dim</span><span class="hud-val" id="hudDim">â€”</span></div>
    </div>
  </div>

  <!-- â•â• DROITE â€” Chat â•â• -->
  <div class="col">
    <div class="col-hd">Chat &amp; Console</div>
    <div class="chat-log" id="chatLog"></div>
    <div class="chat-row">
      <input class="chat-inp" id="chatInp" type="text" placeholder="Message ou /commande..."
             onkeydown="if(event.key==='Enter') sendChat()"/>
      <button class="btn-send" onclick="sendChat()">âž¤</button>
    </div>
  </div>

</div>

<script>
  const socket = io();
  let akOn = false;
  let viewerLoaded = false;

  // â”€â”€ Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  socket.on('status', (d) => {
    const pill = document.getElementById('statusPill');
    const txt  = document.getElementById('statusTxt');
    const srv  = document.getElementById('hudServer');
    pill.className = 'status-pill ' + d.status;
    txt.textContent = {online:'EN LIGNE', offline:'HORS LIGNE', connecting:'CONNEXION...'}[d.status] || d.status.toUpperCase();

    if (d.status === 'online') {
      srv.textContent  = `${d.config.host}:${d.config.port} Â· ${d.config.username}`;
      srv.style.color  = 'var(--accent2)';
      loadViewer();
    } else {
      srv.textContent  = 'Non connectÃ©';
      srv.style.color  = 'var(--muted)';
      hideViewer();
    }

    akOn = d.antikick;
    const btn = document.getElementById('btnAK');
    btn.textContent = `âš™ Anti-Kick : ${akOn ? 'ON' : 'OFF'}`;
    btn.classList.toggle('active', akOn);
  });

  // â”€â”€ Position â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  socket.on('position', (p) => {
    document.getElementById('posX').textContent   = p.x;
    document.getElementById('posY').textContent   = p.y;
    document.getElementById('posZ').textContent   = p.z;
    document.getElementById('posDim').textContent = (p.world||'').replace('minecraft:','');
    document.getElementById('hudX').textContent   = p.x;
    document.getElementById('hudY').textContent   = p.y;
    document.getElementById('hudZ').textContent   = p.z;
    document.getElementById('hudYaw').textContent = p.yaw + 'Â°';
    document.getElementById('hudDim').textContent = (p.world||'').replace('minecraft:','');

    const hp = Math.max(0,Math.min(20,p.health??20));
    const fd = Math.max(0,Math.min(20,p.food??20));
    document.getElementById('barHp').style.width  = (hp/20*100) + '%';
    document.getElementById('barFd').style.width  = (fd/20*100) + '%';
    document.getElementById('valHp').textContent  = hp;
    document.getElementById('valFd').textContent  = fd;
  });

  // â”€â”€ Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  socket.on('chat', (m) => {
    const log = document.getElementById('chatLog');
    const d   = document.createElement('div');
    d.className = `msg ${m.type}`;
    d.innerHTML = `<span class="msg-t">${m.time}</span>${esc(m.text)}`;
    log.appendChild(d);
    log.scrollTop = log.scrollHeight;
  });

  // â”€â”€ EntitÃ©s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  socket.on('entities', (list) => {
    const el = document.getElementById('entList');
    if (!list.length) { el.innerHTML = '<div style="color:var(--muted);font-size:.68rem;padding:8px">Aucune entitÃ©</div>'; return; }
    el.innerHTML = list.map(e => {
      const cls = e.type === 'player' ? 'player' : (['zombie','skeleton','creeper','spider','enderman','witch','pillager'].includes(e.name) ? 'mob' : 'other');
      return `<div class="ent ${cls}"><span>${e.name}</span><span class="ent-dist">${e.dist}m</span></div>`;
    }).join('');
  });

  // â”€â”€ Viewer prismarine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function loadViewer() {
    if (viewerLoaded) return;
    const frame = document.getElementById('prismarineFrame');
    // Le viewer tourne sur le port 8080
    frame.src = `http://${location.hostname}:8080`;
    document.getElementById('viewOverlay').classList.add('hidden');
    viewerLoaded = true;
  }

  function hideViewer() {
    viewerLoaded = false;
    document.getElementById('prismarineFrame').src = 'about:blank';
    document.getElementById('viewOverlay').classList.remove('hidden');
  }

  // â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function startBot() {
    viewerLoaded = false; // permet de recharger le viewer
    socket.emit('start', {
      host:     document.getElementById('cfgHost').value.trim(),
      port:     document.getElementById('cfgPort').value,
      username: document.getElementById('cfgUser').value.trim(),
      password: document.getElementById('cfgPass').value,
      version:  document.getElementById('cfgVer').value,
    });
  }

  function stopBot()    { socket.emit('stop'); }

  function toggleAK() {
    akOn = !akOn;
    socket.emit('antikick', akOn);
  }

  function sendChat() {
    const inp = document.getElementById('chatInp');
    const msg = inp.value.trim();
    if (!msg) return;
    socket.emit('chat', msg);
    inp.value = '';
  }

  function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }
</script>
</body>
</html>
